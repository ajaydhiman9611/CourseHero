!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/assets/js/compiled/",n(n.s=3)}([function(e,t){e.exports=window.React},function(e,t){e.exports=window.ReactDOM},function(e,t,n){e.exports={"apple-login":"apple-login",appleLogin:"apple-login","btn-apple":"btn-apple",btnApple:"btn-apple","fb-login":"fb-login",fbLogin:"fb-login"}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);n(2);const i={},a=(e,t,n)=>fetch("/api/v1/users/",(e=>{const t=e.headers||{};return{...e,cache:"no-cache",redirect:"follow",referrer:"no-referrer",headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8",...t}}})({method:"POST",body:JSON.stringify({externalAuthenticator:"apple",idToken:JSON.stringify(e),schoolIdString:t,reg_user_type:n})})).then(async e=>{if(e.status<200||e.status>=300){const t=await(async e=>{try{var t;const n=await e.text(),r=JSON.parse(n);return r&&r.error&&(null==r?void 0:null==(t=r.error)?void 0:t.message)?r.error.message:r&&r.validation?r.validation.join(", "):(console.error(n),"Unknown error occurred")}catch(e){return console.error(e),"Unknown error occurred"}})(e);throw new Error(t)}return await e.json()});var l=e=>{const{clientId:t,redirectURI:n,state:o,entrySource:l}=e,[s,c]=r.useState(!1),[p,u]=r.useState(""),[d,f]=r.useState(null),[g,m]=r.useState(!1);r.useEffect(()=>{if(!d||g)return;m(!0);const e=void 0!==window._schoolIdString?window._schoolIdString:"",t=void 0!==window._isTutorRegistration&&window._isTutorRegistration?"tutor":$("#registration_user_type").find(":checked").val();a(d,e,t).then(async e=>{if(f(null),m(!1),"success"!==e.status)throw new Error("registration failed, try again later");const t=JSON.parse(e.userDetails);t&&t.isSignUp?window.amplitudeSignupTracking(e.userDetails):window.tracker.login(e.user.user_id,{},"Apple"),window.location.reload()}).catch(e=>{f(null),m(!1)})},[d,g,m]),r.useEffect(()=>{if(s){if(""===p&&!g){var e;const r=e=>{"registrationPage"===l&&""===(()=>window.loadSchoolData())()&&e.stopImmediatePropagation()};null==(e=document.getElementById("appleid-signin"))||e.addEventListener("click",r),window.AppleID.auth.init({clientId:t,redirectURI:n,state:JSON.stringify(o),usePopup:!0,scope:"name email"});const i=e=>{const t={authorization:e.detail.authorization,user:e.detail.user||null,redirect_uri:n};f(t)},a=e=>{};return document.addEventListener("AppleIDSignInOnSuccess",i),document.addEventListener("AppleIDSignInOnFailure",a),()=>{var e;null==(e=document.getElementById("appleid-signin"))||e.removeEventListener("click",r),document.removeEventListener("AppleIDSignInOnSuccess",i),document.removeEventListener("AppleIDSignInOnFailure",a)}}}else(e=>void 0!==i[e]?i[e]:i[e]=new Promise((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=()=>{t()},r.onerror=(e,t)=>{n(t)},document.head.appendChild(r)}))("https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js").then(()=>{c(!0)}).catch(e=>{u(e)})},[s,c,u,p,g,t,n,o,l]);const w=g?r.createElement("img",{src:"/img/blue-ajax-loader.gif"}):r.createElement("div",{id:"appleid-signin",className:"btn-apple",tabIndex:0,"data-color":"black","data-type":"sign in"});return r.createElement("div",{className:"form-group apple-login"},w)};(()=>{let e;if(!(e=document.getElementById("appleLoginButton")))return void console.error("DOM node appleLoginButton not found, cannot render apple login");const t=window.__apple_login_props||{};0!==Object.keys(t).length?o.render(r.createElement(l,t),e):console.error("Invalid props for apple login",t)})()}]);
//# sourceMappingURL=apple-login.924a67d81d0000958add.js.map